<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8">
<title>Computer Factory Tycoon</title>
<style>
body{
  margin:0;
  background:#0b0c10;
  color:#eaeaf0;
  font-family:'Segoe UI', Arial, sans-serif;
}


#ui{
  display:flex;
  flex-wrap:wrap;
  gap:15px;
  padding:15px;
  background:#1f222a;
  justify-content:flex-start;
  align-items:center;
}


.panel{
  background:#252836;
  padding:12px 18px;
  border-radius:12px;
  box-shadow:0 4px 10px rgba(0,0,0,0.4);
  min-width:120px;
  text-align:center;
  font-weight:bold;
  font-size:16px;
}


button, select{
  padding:8px 16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
  transition:0.2s;
  font-size:14px;
}


button{
  background:#4c7dff;
  color:white;
}


button:hover:not(:disabled){
  background:#3a63d1;
}


button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}


#rebirth{
  background:#ff7d4c;
  color:white;
}


#rebirth:hover:not(:disabled){
  background:#e0612a;
}


#upgrade{
  background:#6ac259;
  color:white;
}


#upgrade:hover:not(:disabled){
  background:#55a543;
}


#delete{
  background:#ff4c4c;
  color:white;
}


#delete:hover:not(:disabled){
  background:#d13a3a;
}


select{
  background:#3b3f5c;
  color:white;
}


canvas{
  display:block;
  margin:20px auto;
  background:#0b0c10;
  border-radius:12px;
  box-shadow:0 6px 20px rgba(0,0,0,0.5);
}
</style>
</head>
<body>


<div id="ui">
  <div class="panel">💰 Pengar: <span id="money">50</span></div>
  <div class="panel">🖥️ PC: <span id="computers">0</span></div>
  <div class="panel">♻️ Rebirths: <span id="rebirths">0</span></div>


  <select id="pcType">
    <option value="basic">Basic PC</option>
    <option value="gaming">Gaming PC</option>
    <option value="super">Super PC</option>
    <option value="ultra">Ultra PC – Kräver 1 rebirth</option>
    <option value="quantum">Quantum PC – Kräver 2 rebirths</option>
    <option value="galactic">Galactic PC – Kräver 5 rebirths</option>
  </select>


  <button id="buy">Köp</button>
  <button id="sellAll">Sälj alla</button>
  <button id="upgrade">Uppgradera</button>
  <button id="delete">🗑️ Radera PC</button>
  <button id="rebirth">♻️ Rebirth (100 000 000)</button>
</div>


<canvas id="game" width="900" height="600"></canvas>


<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");


/* ===== SAVE / LOAD ===== */
const SAVE_KEY="computer_factory_tycoon_save";
function saveGame(){
  const data={money,rebirths,inventory,machineCosts,lastTime:Date.now(),
    machines:machines.map(m=>({x:m.x,y:m.y,type:m.type,timer:m.timer,level:m.level,upgradeCost:m.upgradeCost}))};
  localStorage.setItem(SAVE_KEY,JSON.stringify(data));
}
function loadGame(){
  const raw=localStorage.getItem(SAVE_KEY);
  if(!raw) return;
  try{
    const d=JSON.parse(raw);
    money=d.money??money;
    rebirths=d.rebirths??0;
    inventory=d.inventory??inventory;
    machineCosts=d.machineCosts??machineCosts;
    machines=[];
    d.machines?.forEach(m=>{
      const mc=new Machine(m.x,m.y,m.type);
      mc.timer=m.timer; mc.level=m.level; mc.upgradeCost=m.upgradeCost;
      machines.push(mc);
    });
    if(d.lastTime){
      const offlineSeconds=(Date.now()-d.lastTime)/1000;
      machines.forEach(m=>{
        const cycles=Math.floor(offlineSeconds/m.speed());
        inventory[m.type]+=cycles*productionAmount[m.type];
      });
    }
  }catch(e){}
}


/* ===== PC IMAGE ===== */
const pcImage=new Image();
pcImage.src="data:image/svg+xml;utf8,"+encodeURIComponent(`
<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'>
<rect x='4' y='8' width='56' height='36' rx='4' fill='#3a8cff'/>
<rect x='8' y='12' width='48' height='28' rx='2' fill='#00ffee'/>
<rect x='28' y='46' width='8' height='8' fill='#aaa'/>
<rect x='20' y='54' width='24' height='4' fill='#777'/>
</svg>`);


/* ===== DATA ===== */
let money=50, machines=[], rebirths=0;
let inventory={basic:0,gaming:0,super:0,ultra:0,quantum:0,galactic:0};
const productionAmount={basic:1,gaming:5,super:10,ultra:20,quantum:40,galactic:100};
const baseSpeed={basic:2,gaming:4,super:6,ultra:7,quantum:9,galactic:12};
let machineCosts={basic:30,gaming:120,super:240,ultra:800,quantum:3000,galactic:12000};
const sellPrices={basic:10,gaming:20,super:80,ultra:200,quantum:500,galactic:1000};
const baseUpgradeCosts={basic:100,gaming:500,super:1000,ultra:3000,quantum:12000,galactic:50000};
const rebirthRequirement={basic:0,gaming:0,super:0,ultra:1,quantum:2,galactic:5};


/* ===== UI ===== */
const uiMoney=document.getElementById("money");
const uiComp=document.getElementById("computers");
const uiRebirths=document.getElementById("rebirths");
const buyBtn=document.getElementById("buy");
const sellAll=document.getElementById("sellAll");
const pcType=document.getElementById("pcType");
const upgradeBtn=document.getElementById("upgrade");
const deleteBtn=document.getElementById("delete");
const rebirthBtn=document.getElementById("rebirth");
let upgrading=false,deleting=false;


// Update buy button when selecting different PC
pcType.onchange = updateUI;


function updateUI(){
  uiMoney.textContent=Math.floor(money);
  uiComp.textContent=Object.values(inventory).reduce((a,b)=>a+b,0);
  uiRebirths.textContent=rebirths;
  const t=pcType.value;
  let text=`Köp ${t.toUpperCase()} (${machineCosts[t]})`;
  if(rebirthRequirement[t]>0) text+=` – Kräver ${rebirthRequirement[t]} rebirth`;
  buyBtn.disabled = rebirths < rebirthRequirement[t] || money < machineCosts[t];
  buyBtn.textContent=text;
  rebirthBtn.disabled=money<100_000_000;
}


/* ===== DRAW PC WITH ANIMATION ===== */
function drawPC(x,y,t,s,b,type){
  const offsetY=Math.sin(t*5)*3;
  const scale=1 + 0.05*Math.sin(t*10);
  ctx.save();
  ctx.translate(x+20, y+20+offsetY);
  ctx.scale(scale, scale);
  ctx.shadowColor=s;
  ctx.shadowBlur=b;
  ctx.drawImage(pcImage,-20,-20,40,40);
  ctx.restore();
}


/* ===== MACHINE ===== */
class Machine{
  constructor(x,y,type){
    this.x=x; this.y=y; this.type=type;
    this.timer=0; this.level=1; this.upgradeCost=baseUpgradeCosts[type];
    this.flash=0;
  }
  speed(){return baseSpeed[this.type]/this.level}
  update(dt){
    this.timer+=dt;
    if(this.timer>=this.speed()){
      this.timer=0;
      inventory[this.type]+=productionAmount[this.type];
      this.flash=1;
      updateUI();
    }
    if(this.flash>0){
      this.flash-=dt*2;
      if(this.flash<0) this.flash=0;
    }
  }
  draw(t){
    ctx.fillStyle="#1f3cff";
    ctx.fillRect(this.x,this.y,70,70);
    let glow="#3a8cff";
    if(this.type==="gaming") glow="red";
    if(this.type==="super") glow="gold";
    if(this.type==="ultra") glow="purple";
    if(this.type==="quantum") glow="cyan";
    if(this.type==="galactic") glow="magenta";
    drawPC(this.x+15,this.y+15,t,glow,this.flash*15,this.type);
    ctx.fillStyle="#fff"; ctx.font="12px Arial"; ctx.textAlign="center";
    ctx.fillText((this.speed()-this.timer).toFixed(1)+"s",this.x+35,this.y+92);
    ctx.fillText("Lv "+this.level,this.x+35,this.y-10);
  }
}


/* ===== BUTTONS ===== */
buyBtn.onclick=()=>{
  const t=pcType.value;
  if(rebirths<rebirthRequirement[t]) return;
  if(money>=machineCosts[t]){
    money-=machineCosts[t];
    machines.push(new Machine(
      40 + (machines.length % 10) * 80,
      130 + Math.floor(machines.length / 10) * 140,
      t
    ));
    machineCosts[t]*=2;
    updateUI(); saveGame();
  }
};


sellAll.onclick = () => {
  for (let t in inventory) {
    money += inventory[t] * sellPrices[t];
    inventory[t] = 0;
  }
  updateUI();
  saveGame();
};


upgradeBtn.onclick=()=>{
  upgrading=!upgrading; 
  deleting=false;
  upgradeBtn.style.background=upgrading?"#55a543":"#6ac259";
  deleteBtn.style.background="#ff4c4c";
};


deleteBtn.onclick=()=>{
  deleting=!deleting; 
  upgrading=false;
  deleteBtn.style.background=deleting?"#d13a3a":"#ff4c4c";
  upgradeBtn.style.background="#6ac259";
};


canvas.onclick=e=>{
  const r=canvas.getBoundingClientRect();
  const x=e.clientX-r.left, y=e.clientY-r.top;


  if(deleting){
    for(let i=machines.length-1;i>=0;i--){
      const m=machines[i];
      if(x>m.x&&x<m.x+70&&y>m.y&&y<m.y+70){
        machines.splice(i,1);
        deleting=false;
        deleteBtn.style.background="#ff4c4c";
        updateUI();
        saveGame(); 
        return;
      }
    }
  }


  if(upgrading){
    for(let m of machines){
      if(x>m.x && x<m.x+70 && y>m.y && y<m.y+70 && money>=m.upgradeCost){
        money -= m.upgradeCost;
        m.level++;
        m.upgradeCost = Math.floor(m.upgradeCost*1.5);
        upgrading=false;
        upgradeBtn.style.background="#6ac259";
        updateUI();
        saveGame();
        return;
      }
    }
  }
};


/* ===== REBIRTH ===== */
rebirthBtn.onclick=()=>{
  if(money>=100_000_000){
    money=50;
    machines=[];
    inventory={basic:0,gaming:0,super:0,ultra:0,quantum:0,galactic:0};
    machineCosts={basic:30,gaming:120,super:240,ultra:800,quantum:3000,galactic:12000};
    rebirths++;
    pcType.value = "basic"; // reset selection after rebirth
    updateUI();
    saveGame();
  }
};


/* ===== LOOP ===== */
let last=0;
function loop(ts){
  if(!last) last=ts;
  const dt=(ts-last)/1000; last=ts;
  ctx.clearRect(0,0,900,600);
  machines.forEach(m=>{m.update(dt);m.draw(ts/1000);});
  requestAnimationFrame(loop);
}


/* ===== START ===== */
loadGame();
updateUI();
setInterval(saveGame,2000);
window.addEventListener("beforeunload",saveGame);
requestAnimationFrame(loop);
</script>


</body>
</html>